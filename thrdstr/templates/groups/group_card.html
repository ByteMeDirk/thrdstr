{% if groups %}
{% for group in groups %}
    <div class="card mt-2">
        <div class="card-body">
            <div class="row">
                <div class="col-2">
                    {% if group.banner %}
                        <img src="/media/{{ group.banner }}" class="card-img-top rounded-circle"
                             alt="Group banner for {{ group.name }}">
                    {% else %}
                        <img src="/media/group_banners/default.jpg" alt="Group Banner"
                             class="img-fluid rounded-circle">
                    {% endif %}
                </div>
                <div class="col-10">
                    <h5 class="card-title">{{ group.name }}</h5>
                    <p class="card-text">{{ group.description }}</p>
                    <a href="#" class="btn btn-sm btn-dark">Threads</a>
                    {% if group.owner_id == user.id %}
                        <a href="{% url "groups_edit" group.id %}" class="btn btn-sm btn-outline-dark">Edit</a>

                        {# Button to Trigger Delete Group Modal #}
                        <a class="btn btn-sm btn-outline-danger" data-bs-toggle="modal"
                           data-bs-target="#deleteModal">
                            Delete
                        </a>

                        {# Delete Group Modal #}
                        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel"
                             aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="deleteModalLabel">Delete Group
                                            "{{ group.name }}"?</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Are you sure you want to delete this group? This action cannot be undone.
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                                            Close
                                        </button>
                                        <form action="{% url "groups_delete" pk=group.id %}" method="POST">
                                            {% csrf_token %}
                                            <button id="countdownToDelete" type="submit" class="btn btn-danger">Delete
                                                Group
                                                "{{ group.name }}"
                                            </button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
{% endfor %}
<script>
    // Get all the submit buttons on the page
    const submitButtons = document.querySelectorAll('form button[id="countdownToDelete"]');

    // Loop through each submit button and attach a click event listener
    submitButtons.forEach((button) => {
        button.addEventListener('click', (event) => {
            // Prevent the default form submission behavior
            event.preventDefault();

            // Disable the submit button
            button.disabled = true;

            // Set the countdown timer to 5 seconds
            let timeLeft = 7;
            let countdown = setInterval(() => {
                // Update the button text with the remaining time
                button.textContent = `Deleting in ${timeLeft} seconds...`;

                // Decrement the time left
                timeLeft--;

                // If the countdown has reached 0, stop the timer and submit the form
                if (timeLeft === 0) {
                    clearInterval(countdown);
                    button.closest('form').submit();
                }
            }, 1000);

            // Create a cancel button that will appear during the countdown
            const cancelButton = document.createElement('button');
            cancelButton.textContent = 'Cancel';
            cancelButton.classList.add('btn', 'btn-warning');
            cancelButton.style.marginLeft = '.5rem';
            button.after(cancelButton);

            // Attach a click event listener to the cancel button to stop the countdown and reset the form
            cancelButton.addEventListener('click', (event) => {
                // Prevent the default form submission behavior
                event.preventDefault();

                // Stop the countdown timer
                clearInterval(countdown);

                // Remove the cancel button
                cancelButton.remove();

                // Enable the submit button and reset the button text
                button.disabled = false;
                button.textContent = 'Delete';

                // Reset the form to its initial state
                const form = button.closest('form');
                form.reset();
            });

            // Attach a click event listener to the button again to stop the countdown and show the cancel button
            button.addEventListener('click', (event) => {
                // Prevent the default form submission behavior
                event.preventDefault();

                // Stop the countdown timer
                clearInterval(countdown);

                // Show the cancel button
                cancelButton.style.display = 'inline-block';

                // Enable the submit button and update the button text
                button.disabled = false;
                button.textContent = 'Deleting...';
            });
        });
    });
</script>
{% else %}
    <p>There are no groups :(</p>
    <a class="btn btn-outline-dark btn-sm" href="{% url "groups_create" %}">Create a group?</a>
{% endif %}